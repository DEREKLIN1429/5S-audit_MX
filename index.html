<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>5S-audit MX (æ··ç·´5Sç¨½æ ¸)</title>
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary-color: #007bff;
Â  Â  Â  Â  Â  Â  --bg-color: #f4f7f6;
Â  Â  Â  Â  Â  Â  --card-bg: #ffffff;
Â  Â  Â  Â  Â  Â  --danger-color: #dc3545;
Â  Â  Â  Â  Â  Â  --drive-color: #198754;Â 
Â  Â  Â  Â  Â  Â  --frame-color: #00e600;Â 
Â  Â  Â  Â  }
Â  Â  Â  Â  body {Â 
Â  Â  Â  Â  Â  Â  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;Â 
Â  Â  Â  Â  Â  Â  background-color: var(--bg-color);Â 
Â  Â  Â  Â  Â  Â  margin: 0; padding: 0;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; min-height: 100vh;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ç§»é™¤ #login-screen ç›¸é—œ CSS */
Â  Â  Â  Â Â 
Â  Â  Â  Â  #status-modal {
Â  Â  Â  Â  Â  Â  display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .status-box {
Â  Â  Â  Â  Â  Â  background: white; padding: 25px; border-radius: 12px; width: 80%; max-width: 280px;
Â  Â  Â  Â  Â  Â  text-align: center; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
Â  Â  Â  Â  }
Â  Â  Â  Â  .status-icon { font-size: 40px; margin-bottom: 15px; display: block; }
Â  Â  Â  Â  .spinner {
Â  Â  Â  Â  Â  Â  border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color);
Â  Â  Â  Â  Â  Â  border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite;
Â  Â  Â  Â  Â  Â  margin: 0 auto 15px auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
Â  Â  Â  Â  #status-close-btn {
Â  Â  Â  Â  Â  Â  background: var(--primary-color); color: white; border: none; padding: 8px 20px;
Â  Â  Â  Â  Â  Â  border-radius: 5px; margin-top: 15px; cursor: pointer; display: none; font-size: 16px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* ç§»é™¤ #screenshot-modal ç›¸é—œ CSS */

Â  Â  Â  Â  /* ç§»é™¤ #app-screen ä¸Šçš„ display: none; */
Â  Â  Â  Â  #app-screen { width: 100%; max-width: 500px; overflow-y: auto; padding: 20px; box-sizing: border-box; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .author-header {
Â  Â  Â  Â  Â  Â  text-align: center; font-size: 0.75rem; color: #999; padding-bottom: 10px;
Â  Â  Â  Â  Â  Â  letter-spacing: 1px; font-weight: 500;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .header-btn {Â 
Â  Â  Â  Â  Â  Â  font-size: 26px; cursor: pointer; color: #555; padding: 8px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 50%; transition: background 0.2s, color 0.2s;
Â  Â  Â  Â  Â  Â  width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .header-btn:active { background: #e9ecef; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .header-title { text-align: center; flex-grow: 1; }
Â  Â  Â  Â  .header-title h2 { margin: 0; color: #333; font-size: 1.3rem; line-height: 1.4; }
Â  Â  Â  Â  .header-title span { font-size: 0.85em; color: #666; font-weight: normal; }

Â  Â  Â  Â  .card { background: var(--card-bg); padding: 20px; border-radius: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
Â  Â  Â  Â  .section-title { font-weight: bold; color: #555; margin-bottom: 10px; display: block; font-size: 1rem; }

Â  Â  Â  Â  .photo-controls { display: flex; gap: 10px; margin-bottom: 10px; }
Â  Â  Â  Â  .btn-half { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; display: flex; align-items: center; justify-content: center; gap: 5px;}
Â  Â  Â  Â  .btn-cam { background-color: #ffc107; color: #333; }
Â  Â  Â  Â  .btn-gallery { background-color: #fd7e14; }

Â  Â  Â  Â  #preview-container {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  background: #f0fff0;Â 
Â  Â  Â  Â  Â  Â  border: 2px solid var(--frame-color);
Â  Â  Â  Â  Â  Â  border-radius: 8px;Â 
Â  Â  Â  Â  Â  Â  display: flex; align-items: center; justify-content: center;Â 
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  Â  Â  Â  transition: aspect-ratio 0.3s ease;
Â  Â  Â  Â  Â  Â  box-shadow: 0 0 10px rgba(0, 230, 0, 0.15);
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  }
Â  Â  Â  Â  #preview-container:active { opacity: 0.8; }

Â  Â  Â  Â  #preview-container::after {
Â  Â  Â  Â  Â  Â  content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
Â  Â  Â  Â  Â  Â  border: 4px solid transparent;
Â  Â  Â  Â  Â  Â  background:Â 
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to right, var(--frame-color) 4px, transparent 4px) 0 0,
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to bottom, var(--frame-color) 4px, transparent 4px) 0 0,
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to left, var(--frame-color) 4px, transparent 4px) 100% 0,
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to bottom, var(--frame-color) 4px, transparent 4px) 100% 0,
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to right, var(--frame-color) 4px, transparent 4px) 0 100%,
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to top, var(--frame-color) 4px, transparent 4px) 0 100%,
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to left, var(--frame-color) 4px, transparent 4px) 100% 100%,
Â  Â  Â  Â  Â  Â  Â  Â  linear-gradient(to top, var(--frame-color) 4px, transparent 4px) 100% 100%;
Â  Â  Â  Â  Â  Â  background-repeat: no-repeat; background-size: 20px 20px; pointer-events: none; margin: 5px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .ratio-4-3 { aspect-ratio: 4/3; }
Â  Â  Â  Â  .ratio-16-9 { aspect-ratio: 16/9; }
Â  Â  Â  Â  .ratio-9-16 { aspect-ratio: 9/16; }
Â  Â  Â  Â  .ratio-1-1 { aspect-ratio: 1/1; }
Â  Â  Â  Â  .ratio-full { aspect-ratio: 9/16; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .ratio-tag {
Â  Â  Â  Â  Â  Â  position: absolute; top: 10px; left: 10px;
Â  Â  Â  Â  Â  Â  background: var(--frame-color); color: #000; font-weight: bold;
Â  Â  Â  Â  Â  Â  padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; pointer-events: none;
Â  Â  Â  Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  #preview-img { width: 100%; height: 100%; object-fit: contain; display: none; z-index: 1; }
Â  Â  Â  Â  .placeholder { color: #555; text-align: center; font-size: 0.9em; z-index: 0; font-weight: 500;}

Â  Â  Â  Â  textarea {Â 
Â  Â  Â  Â  Â  Â  width: 100%; height: 220px; padding: 12px; border: 2px solid #eee;Â 
Â  Â  Â  Â  Â  Â  border-radius: 8px; font-size: 16px; box-sizing: border-box; resize: none; font-family: inherit;
Â  Â  Â  Â  Â  Â  transition: border 0.3s;
Â  Â  Â  Â  }
Â  Â  Â  Â  textarea:focus { border-color: var(--primary-color); outline: none; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- èªéŸ³é–ƒçˆå‹•ç•« --- */
Â  Â  Â  Â  @keyframes flash-red {
Â  Â  Â  Â  Â  Â  0% { border-color: #eee; box-shadow: none; background-color: white; }
Â  Â  Â  Â  Â  Â  50% { border-color: red; box-shadow: 0 0 15px rgba(255,0,0,0.6); background-color: #fff0f0; }
Â  Â  Â  Â  Â  Â  100% { border-color: #eee; box-shadow: none; background-color: white; }
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  @keyframes flash-purple {
Â  Â  Â  Â  Â  Â  0% { border-color: #eee; box-shadow: none; background-color: white; }
Â  Â  Â  Â  Â  Â  50% { border-color: #a020f0; box-shadow: 0 0 10px rgba(160,32,240,0.4); background-color: #fcf0ff; }
Â  Â  Â  Â  Â  Â  100% { border-color: #eee; box-shadow: none; background-color: white; }
Â  Â  Â  Â  }

Â  Â  Â  Â  @keyframes flash-green {
Â  Â  Â  Â  Â  Â  0% { border-color: #eee; box-shadow: none; }
Â  Â  Â  Â  Â  Â  50% { border-color: #28a745; box-shadow: 0 0 8px rgba(40,167,69,0.3); }
Â  Â  Â  Â  Â  Â  100% { border-color: #eee; box-shadow: none; }
Â  Â  Â  Â  }

Â  Â  Â  Â  .anim-red { animation: flash-red 0.5s infinite; }
Â  Â  Â  Â  .anim-purple { animation: flash-purple 1s infinite; }
Â  Â  Â  Â  .anim-green { animation: flash-green 2s infinite; }

Â  Â  Â  Â  /* --- èªéŸ³/è¤‡è£½æŒ‰éˆ•å€å¡Š START --- */

Â  Â  Â  Â  /* èªéŸ³èˆ‡è¤‡è£½æŒ‰éˆ•å®¹å™¨ï¼šå…©æ¬„ä½ˆå±€ */
Â  Â  Â  Â  .voice-copy-controls {Â 
Â  Â  Â  Â  Â  Â  margin-top: 10px;Â 
Â  Â  Â  Â  Â  Â  display: grid;Â 
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(2, 1fr); /* å…©å€‹æŒ‰éˆ•å¹³å‡åˆ†é…ç©ºé–“ */
Â  Â  Â  Â  Â  Â  gap: 15px;Â 
Â  Â  Â  Â  Â  Â  align-items: flex-start;
Â  Â  Â  Â  }Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* èªè¨€é¸æ“‡/è¨ˆæ™‚å™¨å®¹å™¨ï¼Œä¸¦æ’ */
Â  Â  Â  Â  .lang-timer-container {
Â  Â  Â  Â  Â  Â  grid-column: 1 / 3; /* è·¨è¶Šå…©æ¬„ */
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-between; /* èªè¨€é¸æ“‡é å·¦ï¼Œè¨ˆæ™‚å™¨é å³ */
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  margin-bottom: 5px;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  .quick-lang-container {
Â  Â  Â  Â  Â  Â  display: flex;Â 
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .lang-icon { font-size: 1.2em; margin-right: 5px; }
Â  Â  Â  Â  .small-select {
Â  Â  Â  Â  Â  Â  padding: 4px 8px; border: 1px solid #ccc; border-radius: 15px;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.8rem; background-color: #fff; color: #555; outline: none;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .voice-timer {
Â  Â  Â  Â  Â  Â  text-align: right;Â 
Â  Â  Â  Â  Â  Â  font-size: 0.9em;Â 
Â  Â  Â  Â  Â  Â  color: #555;Â 
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* èªéŸ³æŒ‰éˆ•æ¨£å¼ï¼šæ­£æ–¹å½¢ (ç¬¬ä¸€æ¬„) */
Â  Â  Â  Â  .voice-btn-wrapper {
Â  Â  Â  Â  Â  Â  grid-column: 1 / 2;Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  aspect-ratio: 1/1;Â 
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-voice {Â 
Â  Â  Â  Â  Â  Â  width: 100%; height: 100%; padding: 12px; border: none; border-radius: 12px;
Â  Â  Â  Â  Â  Â  background-color: #17a2b8; color: white; font-weight: bold; cursor: pointer;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; align-items: center; gap: 8px;
Â  Â  Â  Â  Â  Â  font-size: 16px;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  line-height: 1.2;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-voice.recording { background-color: var(--danger-color); animation: pulse 1s infinite; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* è¤‡è£½æ–‡å­—æŒ‰éˆ•æ¨£å¼ï¼šæ­£æ–¹å½¢ (ç¬¬äºŒæ¬„) */
Â  Â  Â  Â  .copy-btn-wrapper {
Â  Â  Â  Â  Â  Â  grid-column: 2 / 3;Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  aspect-ratio: 1/1;Â 
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  padding: 0;
Â  Â  Â  Â  Â  Â  justify-self: end;
Â  Â  Â  Â  }

Â  Â  Â  Â  .btn-copy-main {
Â  Â  Â  Â  Â  Â  background-color: #008CBA;Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  width: 100%; height: 100%; padding: 12px; border: none; border-radius: 12px;
Â  Â  Â  Â  Â  Â  font-weight: bold; cursor: pointer;
Â  Â  Â  Â  Â  Â  display: flex; justify-content: center; align-items: center; gap: 8px;
Â  Â  Â  Â  Â  Â  font-size: 16px;Â 
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  line-height: 1.2;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* --- èªéŸ³/è¤‡è£½æŒ‰éˆ•å€å¡Š END --- */


Â  Â  Â  Â  /* --- åº•éƒ¨æŒ‰éˆ•ç¾¤çµ„ä¿®æ”¹ --- */
Â  Â  Â  Â  .footer-btns-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: repeat(2, 1fr); /* 2å€‹æŒ‰éˆ•æ’ä¸€æ’ */
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  padding-bottom: 30px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-main {Â 
Â  Â  Â  Â  Â  Â  width: 100%;Â 
Â  Â  Â  Â  Â  Â  padding: 15px;Â 
Â  Â  Â  Â  Â  Â  border: none;Â 
Â  Â  Â  Â  Â  Â  border-radius: 15px;Â 
Â  Â  Â  Â  Â  Â  font-size: 18px; /* å­—é«”åŠ å¤§ */
Â  Â  Â  Â  Â  Â  font-weight: bold;Â 
Â  Â  Â  Â  Â  Â  cursor: pointer;Â 
Â  Â  Â  Â  Â  Â  color: white;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  aspect-ratio: 1/1; /* è¨­ç‚ºæ­£æ–¹å½¢ (Save & View Excel) */
Â  Â  Â  Â  Â  Â  line-height: 1.2;
Â  Â  Â  Â  Â  Â  flex-direction: column;Â 
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  /* æª¢è¦–é›²ç«¯ç…§ç‰‡æŒ‰éˆ• (é«˜åº¦ç¸®æ¸›ï¼Œä¸¦ä½”æ»¿å…©æ¬„) */
Â  Â  Â  Â  .btn-drive.btn-full-width {
Â  Â  Â  Â  Â  Â  grid-column: 1 / -1; /* è·¨è¶Šå…©æ¬„ */
Â  Â  Â  Â  Â  Â  aspect-ratio: 4 / 1; /* ç¸®æ¸›é«˜åº¦ */
Â  Â  Â  Â  Â  Â  flex-direction: row; /* é©åˆé•·æ¢å½¢ï¼Œæ–‡å­—æ°´å¹³æ’ç‰ˆ */
Â  Â  Â  Â  Â  Â  gap: 15px;
Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .btn-save { background-color: var(--primary-color); }
Â  Â  Â  Â  .btn-view { background-color: #6c757d; }
Â  Â  Â  Â  .btn-drive { background-color: var(--drive-color); }

Â  Â  Â  Â  /* --- è¨­å®šå½ˆçª— (ç§»é™¤å¯†ç¢¼è¨­å®šå€å¡Š) --- */
Â  Â  Â  Â  #settings-modal {
Â  Â  Â  Â  Â  Â  display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-content {
Â  Â  Â  Â  Â  Â  background: white; width: 90%; max-width: 400px; padding: 25px;Â 
Â  Â  Â  Â  Â  Â  border-radius: 15px; max-height: 85vh; overflow-y: auto;
Â  Â  Â  Â  }
Â  Â  Â  Â  .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;}
Â  Â  Â  Â  .modal-group { margin-bottom: 15px; }
Â  Â  Â  Â  .modal-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; color: #333; }
Â  Â  Â  Â  .modal-input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 0.95rem;}
Â  Â  Â  Â  select.modal-input { background: white; }
Â  Â  Â  Â  .hint-text { font-size: 0.8rem; color: #888; margin-top: 3px; }

Â  Â  Â  Â  @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
Â  Â  Â  Â  .hidden { display: none !important; }
Â  Â  </style>
</head>
<body>

Â  Â  <div id="status-modal">
Â  Â  Â  Â  <div class="status-box">
Â  Â  Â  Â  Â  Â  <div id="status-spinner" class="spinner"></div>
Â  Â  Â  Â  Â  Â  <div id="status-icon" class="status-icon" style="display:none;"></div>
Â  Â  Â  Â  Â  Â  <h3 id="status-text" style="color:#333; margin:0;">Uploading...</h3>
Â  Â  Â  Â  Â  Â  <p id="status-subtext" style="color:#666; font-size:0.9em; margin-top:5px;">(è³‡æ–™ä¸Šå‚³ä¸­...)</p>
Â  Â  Â  Â  Â  Â  <button id="status-close-btn" onclick="closeStatusModal()">OK</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="app-screen">
Â  Â  Â  Â  <div class="author-header">Author: DERER LIN</div>

Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  <div class="header-btn" onclick="openSettings()" title="Settings (è¨­å®š)">âš™ï¸</div>
Â  Â  Â  Â  Â  Â  <div class="header-title">
Â  Â  Â  Â  Â  Â  Â  Â  <h2>5S-audit ï¼­X<br>æ··ç·´5Sç¨½æ ¸</h2>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="header-btn" onclick="openSettings()" title="Settings (è¨­å®š)">âš™ï¸</div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <span class="section-title">0. Defect Worker ID (æŒ‡æ‘˜å·¥è™Ÿ/äººå“¡)</span>
Â  Â  Â  Â  Â  Â  <input type="text" id="workerIdInput" class="modal-input" placeholder="Enter Worker ID (è«‹è¼¸å…¥å·¥è™Ÿ)">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <span class="section-title">1. Photo (åœ–ç‰‡ç´€éŒ„)</span>
Â  Â  Â  Â  Â  Â  <div class="photo-controls">
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-cam" onclick="triggerCam()">ğŸ“· Camera (æ‹ç…§)</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-half btn-gallery" onclick="triggerGallery()">ğŸ–¼ï¸ Gallery (ç›¸ç°¿)</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div id="preview-container" class="ratio-4-3" onclick="triggerCam()" title="Click to take photo">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="ratio-tag" id="ratio-display-tag">Ratio: 4:3</div>
Â  Â  Â  Â  Â  Â  Â  Â  <span class="placeholder">Tap here to Take Photo<br>(é»æ“Šæ­¤è™•æ‹ç…§)</span>
Â  Â  Â  Â  Â  Â  Â  Â  <img id="preview-img">
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <input type="file" id="input-cam" accept="image/*" capture="environment" class="hidden" onchange="handleFile(this)">
Â  Â  Â  Â  Â  Â  <input type="file" id="input-gallery" accept="image/*" class="hidden" onchange="handleFile(this)">
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="card" id="note-card">
Â  Â  Â  Â  Â  Â  <span class="section-title">2. Note (æ–‡å­—/èªéŸ³)</span>
Â  Â  Â  Â  Â  Â  <textarea id="noteInput" placeholder="After taking a photo, type here or use voice... (æ‹ç…§å¾Œï¼Œåœ¨æ­¤è¼¸å…¥æˆ–ä½¿ç”¨èªéŸ³)"></textarea>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="voice-copy-controls">
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="lang-timer-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="quick-lang-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="lang-icon">ğŸŒ</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="main-lang" class="small-select" onchange="syncLanguage('main')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="cmn-Hant-TW">ä¸­æ–‡ (ç¹é«”)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="en-US">English</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ja-JP">æ—¥æœ¬èª</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="hi-IN">Hindi (å°åœ°èª)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="voice-timer">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Time left: <span id="display-timeout" style="color:#d63384; font-size:1.1em;">10</span> s
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="voice-btn-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn-voice" id="voiceBtn" onclick="toggleVoice()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ¤<br>Start Voice<br>(é–‹å§‹éŒ„éŸ³)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  <div class="copy-btn-wrapper">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-copy-main" onclick="copyNote()">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“‹<br>è¤‡è£½æ–‡å­—
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="footer-btns-grid">
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-save" id="saveBtn" onclick="saveToCloud()">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ’¾<br>Save to Cloud<br>(å­˜æª”è‡³é›²ç«¯)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-view" onclick="viewExcel()">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“Š<br>View Excel<br>(æª¢è¦– Excel)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button class="btn-main btn-drive btn-full-width" onclick="viewDriveFolder()">
Â  Â  Â  Â  Â  Â  Â  Â  ğŸ“‚ View Photos (æª¢è¦–é›²ç«¯ç…§ç‰‡)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div id="settings-modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <div class="modal-header">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>Settings (è¨­å®š)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <button onclick="closeSettings()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label>1. Voice Timeout (éŒ„éŸ³ç¸½ç§’æ•¸)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="set-timeout" class="modal-input" value="10">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label style="color:red;">2. Red Frame Warning (ç´…æ¡†é–ƒçˆè­¦ç¤ºç§’æ•¸)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="set-warning" class="modal-input" value="3" placeholder="e.g. 3">
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label>3. Language (èªéŸ³è¾¨è­˜èªè¨€)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="set-lang" class="modal-input" onchange="syncLanguage('settings')">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="cmn-Hant-TW">Traditional Chinese (ç¹é«”ä¸­æ–‡)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="en-US">English (è‹±æ–‡)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="ja-JP">Japanese (æ—¥æ–‡)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="hi-IN">Hindi (å°åœ°èª)</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="modal-group">
Â  Â  Â  Â  Â  Â  Â  Â  <label>4. Photo Aspect Ratio (ç…§ç‰‡æ¯”ä¾‹)</label>
Â  Â  Â  Â  Â  Â  Â  Â  <select id="set-ratio" class="modal-input">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="4/3">4:3 (Standard)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="16/9">16:9 (Wide)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="9/16">9:16 (Vertical / ç›´å¼)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="1/1">1:1 (Square)</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="FULL">FULL (Original / å…¨ç•«é¢)</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="hint-text">* Applies auto-crop unless set to FULL.</div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div style="text-align: center; color: var(--primary-color); font-size: 0.9em; margin-top: 15px;">
Â  Â  Â  Â  Â  Â  Â  Â  <p>âœ… Cloud Paths are Locked (System Mode)</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <button class="btn-main btn-save" style="aspect-ratio: unset; flex-direction: row; padding: 15px;" onclick="saveSettings()">Save Settings (å„²å­˜è¨­å®š)</button>
Â  Â  Â  Â  </div>
Â  Â  </div>

<script>
Â  Â  // ================= åˆå§‹åŒ– & FIXED PATHS (å·²å¯«æ­») =================
Â  Â  // Apps Script URL (è³‡æ–™ä¸Šå‚³)
Â  Â  const FIXED_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxEG698lD6Q9vJ0p__Ah78Dky27Pqrq7TFyYVDOHqcCs9-WyYjoD5TttiHpjQDN9W8jWA/exec";
Â  Â  // Google Sheet ID (æª¢è¦– Excel)
Â  Â  const FIXED_SHEET_ID = "1BX_jkYOmaMuqluXDfxNqRFm92Im764RBsxdkuDxPuTk";Â 
Â  Â  // Google Drive Folder ID (æª¢è¦–ç…§ç‰‡)
Â  Â  const FIXED_FOLDER_ID = "1vB96sHAYzW4_JXIRPdEbTnHMOAZrCQoW";

Â  Â  let processedImageBase64 = "";Â 
Â  Â  let recognition;
Â  Â Â 
Â  Â  let isRecording = false;Â 
Â  Â  let isManualStop = false;Â 
Â  Â  let voiceTimer = null;Â 
Â  Â  let countdownInterval = null;Â 
Â  Â  let punctuationTimer = null;Â 
Â  Â  let timeLeft = 0;Â 
Â  Â  let snapshotText = "";Â 

Â  Â  window.onload = function() {
Â  Â  Â  Â  // ç§»é™¤ç™»å…¥æª¢æŸ¥ï¼Œç›´æ¥é¡¯ç¤º App
Â  Â  Â  Â  showApp();
Â  Â  Â  Â  loadSettingsToUI();
Â  Â  };

Â  Â  function showApp() {
Â  Â  Â  Â  document.getElementById('app-screen').style.display = 'block';
Â  Â  Â  Â  applySettings();Â 
Â  Â  }

Â  Â  // ================= è¨­å®šåŠŸèƒ½ & èªè¨€åŒæ­¥ =================
Â  Â  function openSettings() {
Â  Â  Â  Â  loadSettingsToUI();
Â  Â  Â  Â  document.getElementById('settings-modal').style.display = 'flex';
Â  Â  }
Â  Â  function closeSettings() {
Â  Â  Â  Â  document.getElementById('settings-modal').style.display = 'none';
Â  Â  }
Â  Â Â 
Â  Â  function syncLanguage(source) {
Â  Â  Â  Â  let val;
Â  Â  Â  Â  if (source === 'main') {
Â  Â  Â  Â  Â  Â  val = document.getElementById('main-lang').value;
Â  Â  Â  Â  Â  Â  document.getElementById('set-lang').value = val;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  val = document.getElementById('set-lang').value;
Â  Â  Â  Â  Â  Â  document.getElementById('main-lang').value = val;
Â  Â  Â  Â  }
Â  Â  Â  Â  localStorage.setItem("cfg_lang", val);
Â  Â  }

Â  Â  function saveSettings() {
Â  Â  Â  Â  // ç§»é™¤å¯†ç¢¼ç›¸é—œæ“ä½œ
Â  Â  Â  Â  const timeout = document.getElementById('set-timeout').value;
Â  Â  Â  Â  const warning = document.getElementById('set-warning').value;
Â  Â  Â  Â  const lang = document.getElementById('set-lang').value;Â 
Â  Â  Â  Â  const ratio = document.getElementById('set-ratio').value;

Â  Â  Â  Â  localStorage.setItem("cfg_timeout", timeout);
Â  Â  Â  Â  localStorage.setItem("cfg_warning", warning);
Â  Â  Â  Â  localStorage.setItem("cfg_lang", lang);
Â  Â  Â  Â  localStorage.setItem("cfg_ratio", ratio);
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('main-lang').value = lang;

Â  Â  Â  Â  alert("Settings Saved!");
Â  Â  Â  Â  closeSettings();
Â  Â  Â  Â  applySettings();
Â  Â  }

Â  Â  function loadSettingsToUI() {
Â  Â  Â  Â  document.getElementById('set-timeout').value = localStorage.getItem("cfg_timeout") || "10";
Â  Â  Â  Â  document.getElementById('set-warning').value = localStorage.getItem("cfg_warning") || "3";
Â  Â  Â  Â  const savedLang = localStorage.getItem("cfg_lang") || "cmn-Hant-TW";
Â  Â  Â  Â  document.getElementById('set-lang').value = savedLang;
Â  Â  Â  Â  document.getElementById('main-lang').value = savedLang;
Â  Â  Â  Â  document.getElementById('set-ratio').value = localStorage.getItem("cfg_ratio") || "4/3";
Â  Â  }

Â  Â  function applySettings() {
Â  Â  Â  Â  const timeout = localStorage.getItem("cfg_timeout") || "10";
Â  Â  Â  Â  document.getElementById('display-timeout').innerText = timeout;
Â  Â  Â  Â  const ratio = localStorage.getItem("cfg_ratio") || "4/3";
Â  Â  Â  Â  const container = document.getElementById('preview-container');
Â  Â  Â  Â  const tag = document.getElementById('ratio-display-tag');
Â  Â  Â  Â Â 
Â  Â  Â  Â  container.className = "";Â 
Â  Â  Â  Â  container.style.aspectRatio = "";

Â  Â  Â  Â  if(ratio === "4/3") container.classList.add("ratio-4-3");
Â  Â  Â  Â  else if(ratio === "16/9") container.classList.add("ratio-16-9");
Â  Â  Â  Â  else if(ratio === "9/16") container.classList.add("ratio-9-16");
Â  Â  Â  Â  else if(ratio === "1/1") container.classList.add("ratio-1-1");
Â  Â  Â  Â  else if(ratio === "FULL") container.classList.add("ratio-full");
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(ratio === "FULL") tag.innerText = "Ratio: Full (Original)";
Â  Â  Â  Â  else tag.innerText = "Ratio: " + ratio.replace("/", ":");
Â  Â  }

Â  Â  // ================= åœ–ç‰‡è™•ç† (ä¸è®Š) =================
Â  Â  function triggerCam() { document.getElementById('input-cam').click(); }
Â  Â  function triggerGallery() { document.getElementById('input-gallery').click(); }
Â  Â  function handleFile(input) {
Â  Â  Â  Â  if (input.files && input.files[0]) {
Â  Â  Â  Â  Â  Â  const file = input.files[0];
Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  reader.onload = function(e) {
Â  Â  Â  Â  Â  Â  Â  Â  const img = new Image();
Â  Â  Â  Â  Â  Â  Â  Â  img.onload = function() { processImageWithCanvas(img); };
Â  Â  Â  Â  Â  Â  Â  Â  img.src = e.target.result;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  }
Â  Â  }
Â  Â  function processImageWithCanvas(img) {
Â  Â  Â  Â  const canvas = document.createElement('canvas');
Â  Â  Â  Â  const ctx = canvas.getContext('2d');
Â  Â  Â  Â  const ratioStr = localStorage.getItem("cfg_ratio") || "4/3";
Â  Â  Â  Â Â 
Â  Â  Â  Â  let targetRatio = 4/3;
Â  Â  Â  Â  let isFull = false;

Â  Â  Â  Â  if(ratioStr === "FULL") isFull = true;
Â  Â  Â  Â  else if(ratioStr === "16/9") targetRatio = 16/9;
Â  Â  Â  Â  else if(ratioStr === "9/16") targetRatio = 9/16;
Â  Â  Â  Â  else if(ratioStr === "1/1") targetRatio = 1;

Â  Â  Â  Â  let srcW = img.width; let srcH = img.height;
Â  Â  Â  Â  let drawW, drawH, startX, startY;

Â  Â  Â  Â  if (isFull) {
Â  Â  Â  Â  Â  Â  drawW = srcW; drawH = srcH; startX = 0; startY = 0;
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  let srcRatio = srcW / srcH;
Â  Â  Â  Â  Â  Â  if (srcRatio > targetRatio) {
Â  Â  Â  Â  Â  Â  Â  Â  drawH = srcH; drawW = srcH * targetRatio;
Â  Â  Â  Â  Â  Â  Â  Â  startX = (srcW - drawW) / 2; startY = 0;
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  drawW = srcW; drawH = srcW / targetRatio;
Â  Â  Â  Â  Â  Â  Â  Â  startX = 0; startY = (srcH - drawH) / 2;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  const MAX_WIDTH = 1000;Â 
Â  Â  Â  Â  const scale = MAX_WIDTH / drawW;
Â  Â  Â  Â  canvas.width = MAX_WIDTH; canvas.height = drawH * scale;

Â  Â  Â  Â  ctx.drawImage(img, startX, startY, drawW, drawH, 0, 0, canvas.width, canvas.height);
Â  Â  Â  Â  processedImageBase64 = canvas.toDataURL('image/jpeg', 0.8);
Â  Â  Â  Â Â 
Â  Â  Â  Â  const preview = document.getElementById('preview-img');
Â  Â  Â  Â  preview.src = processedImageBase64;
Â  Â  Â  Â  preview.style.display = 'block';
Â  Â  Â  Â  document.querySelector('.placeholder').style.display = 'none';

Â  Â  Â  Â  if(isFull) {
Â  Â  Â  Â  Â  Â  Â const container = document.getElementById('preview-container');
Â  Â  Â  Â  Â  Â  Â container.className = "";Â 
Â  Â  Â  Â  Â  Â  Â container.style.aspectRatio = `${canvas.width} / ${canvas.height}`;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // ================= èªéŸ³åŠŸèƒ½ (ä¸è®Š) =================
Â  Â  function toggleVoice() {
Â  Â  Â  Â  if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
Â  Â  Â  Â  Â  Â  alert("Browser not supported"); return;
Â  Â  Â  Â  }
Â  Â  Â  Â  if (isRecording) {
Â  Â  Â  Â  Â  Â  manualStopVoice();Â 
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  startVoice();
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  function startVoice() {
Â  Â  Â  Â  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
Â  Â  Â  Â  recognition = new SpeechRecognition();
Â  Â  Â  Â Â 
Â  Â  Â  Â  recognition.lang = document.getElementById('main-lang').value || 'cmn-Hant-TW';
Â  Â  Â  Â  recognition.continuous = true;Â 
Â  Â  Â  Â  recognition.interimResults = true;Â 

Â  Â  Â  Â  isRecording = true;
Â  Â  Â  Â  isManualStop = false;Â 
Â  Â  Â  Â  document.getElementById('voiceBtn').classList.add('recording');
Â  Â  Â  Â  document.getElementById('voiceBtn').innerHTML = "ğŸ›‘<br>Stop";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  snapshotText = document.getElementById('noteInput').value;
Â  Â  Â  Â  if(snapshotText.length > 0 && !snapshotText.endsWith(" ")) {
Â  Â  Â  Â  Â  Â  snapshotText += " ";
Â  Â  Â  Â  }

Â  Â  Â  Â  const timeoutSec = parseInt(localStorage.getItem("cfg_timeout") || "10");
Â  Â  Â  Â  const warningSec = parseInt(localStorage.getItem("cfg_warning") || "3");
Â  Â  Â  Â  const purpleSec = warningSec + 5;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  timeLeft = timeoutSec;
Â  Â  Â  Â  document.getElementById('display-timeout').innerText = timeLeft;
Â  Â  Â  Â Â 
Â  Â  Â  Â  const noteInput = document.getElementById('noteInput');
Â  Â  Â  Â  noteInput.classList.remove('anim-red', 'anim-purple', 'anim-green');
Â  Â  Â  Â  noteInput.classList.add('anim-green');Â 

Â  Â  Â  Â  if(countdownInterval) clearInterval(countdownInterval);

Â  Â  Â  Â  countdownInterval = setInterval(() => {
Â  Â  Â  Â  Â  Â  timeLeft--;
Â  Â  Â  Â  Â  Â  document.getElementById('display-timeout').innerText = timeLeft;

Â  Â  Â  Â  Â  Â  noteInput.classList.remove('anim-red', 'anim-purple', 'anim-green');

Â  Â  Â  Â  Â  Â  if(timeLeft <= warningSec) {
Â  Â  Â  Â  Â  Â  Â  Â  noteInput.classList.add('anim-red');
Â  Â  Â  Â  Â  Â  } else if (timeLeft <= purpleSec) {
Â  Â  Â  Â  Â  Â  Â  Â  noteInput.classList.add('anim-purple');
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  noteInput.classList.add('anim-green');
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if(timeLeft <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  manualStopVoice();Â 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }, 1000);

Â  Â  Â  Â  recognition.onresult = function(event) {
Â  Â  Â  Â  Â  Â  let currentSessionText = '';Â 
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for (let i = event.resultIndex; i < event.results.length; ++i) {
Â  Â  Â  Â  Â  Â  Â  Â  currentSessionText += event.results[i][0].transcript;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const noteArea = document.getElementById('noteInput');
Â  Â  Â  Â  Â  Â  noteArea.value = snapshotText + currentSessionText;
Â  Â  Â  Â  Â  Â  noteArea.scrollTop = noteArea.scrollHeight;

Â  Â  Â  Â  Â  Â  if(punctuationTimer) clearTimeout(punctuationTimer);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if(currentSessionText.trim().length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  punctuationTimer = setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recognition.stop();Â 
Â  Â  Â  Â  Â  Â  Â  Â  }, 1000);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  recognition.onend = function() {
Â  Â  Â  Â  Â  Â  if(punctuationTimer) clearTimeout(punctuationTimer);

Â  Â  Â  Â  Â  Â  if (isRecording && !isManualStop && timeLeft > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  let currentVal = document.getElementById('noteInput').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  if(currentVal.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lastChar = currentVal.slice(-1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const marks = ["ï¼Œ", "ã€‚", ",", "."];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if(!marks.includes(lastChar)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const lang = document.getElementById('main-lang').value;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const mark = lang.includes('en') ? ", " : "ï¼Œ";
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentVal += mark;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('noteInput').value = currentVal;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  snapshotText = document.getElementById('noteInput').value;
Â  Â  Â  Â  Â  Â  Â  Â  if(snapshotText.length > 0 && !snapshotText.endsWith(" ")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  snapshotText += " ";Â 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  recognition.start();Â 
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  resetVoiceUI();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };
Â  Â  Â  Â Â 
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  recognition.start();
Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  console.error("Start error", e);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function manualStopVoice() {
Â  Â  Â  Â  isRecording = false;Â 
Â  Â  Â  Â  isManualStop = true;Â 
Â  Â  Â  Â  if(recognition) recognition.stop();
Â  Â  Â  Â  resetVoiceUI();
Â  Â  }

Â  Â  function resetVoiceUI() {
Â  Â  Â  Â  if(countdownInterval) clearInterval(countdownInterval);
Â  Â  Â  Â  if(punctuationTimer) clearTimeout(punctuationTimer);
Â  Â  Â  Â Â 
Â  Â  Â  Â  document.getElementById('voiceBtn').classList.remove('recording');
Â  Â  Â  Â  document.getElementById('voiceBtn').innerHTML = "ğŸ¤<br>Start Voice<br>(é–‹å§‹éŒ„éŸ³)";Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const noteInput = document.getElementById('noteInput');
Â  Â  Â  Â  noteInput.classList.remove('anim-red', 'anim-purple', 'anim-green');
Â  Â  Â  Â Â 
Â  Â  Â  Â  const originalTime = localStorage.getItem("cfg_timeout") || "10";
Â  Â  Â  Â  document.getElementById('display-timeout').innerText = originalTime;
Â  Â  }

Â  Â  // ================= è¤‡è£½åŠŸèƒ½ (ä¸è®Š) =================
Â  Â Â 
Â  Â  function copyNote() {
Â  Â  Â  Â  const note = document.getElementById('noteInput').value;
Â  Â  Â  Â  if (note.trim() === "") {
Â  Â  Â  Â  Â  Â  alert("Note is empty! (æ–‡å­—å…§å®¹ç‚ºç©º)");
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  navigator.clipboard.writeText(note)
Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  Â  showStatus('success', 'Copied!', 'æ–‡å­—å…§å®¹å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ã€‚');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => { closeStatusModal(); }, 1800);
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch(err => {
Â  Â  Â  Â  Â  Â  Â  Â  alert('Copy failed: ' + err + ' (è«‹å…è¨±å‰ªè²¼ç°¿å­˜å–)');
Â  Â  Â  Â  Â  Â  });
Â  Â  }

Â  Â  // ================= ä¸Šå‚³èˆ‡æª¢è¦– (ä½¿ç”¨ FIXED å¸¸æ•¸) =================
Â  Â  function showStatus(type, title, subtitle) {
Â  Â  Â  Â  const modal = document.getElementById('status-modal');
Â  Â  Â  Â  const spinner = document.getElementById('status-spinner');
Â  Â  Â  Â  const icon = document.getElementById('status-icon');
Â  Â  Â  Â  const text = document.getElementById('status-text');
Â  Â  Â  Â  const sub = document.getElementById('status-subtext');
Â  Â  Â  Â  const closeBtn = document.getElementById('status-close-btn');

Â  Â  Â  Â  modal.style.display = 'flex';
Â  Â  Â  Â  text.innerText = title; sub.innerText = subtitle;

Â  Â  Â  Â  if(type === 'loading') {
Â  Â  Â  Â  Â  Â  spinner.style.display = 'block'; icon.style.display = 'none'; closeBtn.style.display = 'none';
Â  Â  Â  Â  } else if(type === 'success') {
Â  Â  Â  Â  Â  Â  spinner.style.display = 'none'; icon.style.display = 'block'; icon.innerText = 'âœ…'; closeBtn.style.display = 'none';
Â  Â  Â  Â  } else if(type === 'error') {
Â  Â  Â  Â  Â  Â  spinner.style.display = 'none'; icon.style.display = 'block'; icon.innerText = 'âŒ'; closeBtn.style.display = 'block';
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function closeStatusModal() { document.getElementById('status-modal').style.display = 'none'; }

Â  Â  function saveToCloud() {
Â  Â  Â  Â  const note = document.getElementById('noteInput').value;
Â  Â  Â  Â  const workerId = document.getElementById('workerIdInput').value;Â 
Â  Â  Â  Â Â 
Â  Â  Â  Â  const folderId = FIXED_FOLDER_ID;
Â  Â  Â  Â  // ä½¿ç”¨å®Œæ•´çš„ Apps Script URL
Â  Â  Â  Â  const scriptUrl = FIXED_SCRIPT_URL;

Â  Â  Â  Â  if(!processedImageBase64 && !note && !workerId) {
Â  Â  Â  Â  Â  Â  alert("Empty! Please take a photo, write a note, or enter Worker ID."); return;
Â  Â  Â  Â  }

Â  Â  Â  Â  const btn = document.getElementById('saveBtn');
Â  Â  Â  Â  btn.disabled = true;
Â  Â  Â  Â  showStatus('loading', 'Uploading...', 'è³‡æ–™ä¸Šå‚³ä¸­...');

Â  Â  Â  Â  const data = {Â 
Â  Â  Â  Â  Â  Â  note: note,Â 
Â  Â  Â  Â  Â  Â  image: processedImageBase64,Â 
Â  Â  Â  Â  Â  Â  folderId: folderId,
Â  Â  Â  Â  Â  Â  workerId: workerIdÂ 
Â  Â  Â  Â  };

Â  Â  Â  Â  fetch(scriptUrl, {
Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  body: JSON.stringify(data)
Â  Â  Â  Â  })
Â  Â  Â  Â  .then(r => r.json())
Â  Â  Â  Â  .then(res => {
Â  Â  Â  Â  Â  Â  showStatus('success', 'Upload Success!', 'ä¸Šå‚³æˆåŠŸï¼');
Â  Â  Â  Â  Â  Â  document.getElementById('noteInput').value = "";
Â  Â  Â  Â  Â  Â  document.getElementById('workerIdInput').value = "";Â 
Â  Â  Â  Â  Â  Â  processedImageBase64 = "";
Â  Â  Â  Â  Â  Â  document.getElementById('preview-img').style.display = 'none';
Â  Â  Â  Â  Â  Â  document.querySelector('.placeholder').style.display = 'block';
Â  Â  Â  Â  Â  Â  applySettings();
Â  Â  Â  Â  Â  Â  setTimeout(() => { closeStatusModal(); }, 2000);
Â  Â  Â  Â  })
Â  Â  Â  Â  .catch(e => {
Â  Â  Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  Â  Â  showStatus('error', 'Upload Failed', 'ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚');
Â  Â  Â  Â  })
Â  Â  Â  Â  .finally(() => {
Â  Â  Â  Â  Â  Â  btn.disabled = false;
Â  Â  Â  Â  });
Â  Â  }

Â  Â  function viewExcel() {
Â  Â  Â  Â  // ä½¿ç”¨å›ºå®š Sheet ID æ§‹å»º Google Sheet ç¶²å€
Â  Â  Â  Â  const url = `https://docs.google.com/spreadsheets/d/${FIXED_SHEET_ID}/edit`;
Â  Â  Â  Â  window.open(url, '_blank');
Â  Â  }

Â  Â  function viewDriveFolder() {
Â  Â  Â  Â  const folderId = FIXED_FOLDER_ID;
Â  Â  Â  Â  if(folderId && folderId.trim() !== "") {
Â  Â  Â  Â  Â  Â  // ä½¿ç”¨å›ºå®š Folder ID æ§‹å»º Google Drive ç¶²å€
Â  Â  Â  Â  Â  Â  window.open("https://drive.google.com/drive/folders/" + folderId, '_blank');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  if(confirm("Folder ID not set. Open Google Drive Root?\n(å°šæœªè¨­å®šè³‡æ–™å¤¾ IDï¼Œè¦é–‹å•Ÿé›²ç«¯ç¡¬ç¢Ÿæ ¹ç›®éŒ„å—ï¼Ÿ)")) {
Â  Â  Â  Â  Â  Â  Â  Â  window.open("https://drive.google.com/drive/my-drive", '_blank');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }
</script>

</body>
</html>
